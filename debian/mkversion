#!/usr/bin/perl -Tw
use strict;

$ENV{PATH} = "/usr/bin";

my $name = undef;
my $number = undef;

sub parse_changelog() {
    open(CHANGELOG, "-|", "dpkg-parsechangelog") or exit 1;
    while (<CHANGELOG>) {
	$name = $1 if /^Source:\s+(\S+)/;
	$number = $1 if /^Version:\s+(\S+)/;
    }
    close(CHANGELOG);
    defined $name or die "$0: package name not found in changelog\n";
    defined $number or die "$0: version number not found in changelog\n";
}

sub write_version() {
    my $t = localtime;
    print <<EOF;
(* Automatically generated by $0 on $t *)

let name = "$name"
let number = "$number"
EOF
}

parse_changelog();
write_version();
